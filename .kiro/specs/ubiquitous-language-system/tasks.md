# 実装計画

- [x] 1. プロジェクト構造とコア設定のセットアップ
  - Next.jsとHonoのモノレポ構造を作成
  - TypeScript設定ファイルを構成
  - 共有型定義パッケージを作成
  - _要求: 1.1, 3.1_

- [ ] 2. データベースとスキーマの実装
  - [x] 2.1 PostgreSQLデータベース接続を設定
    - データベース接続プールを実装
    - 環境変数による設定管理
    - _要求: 1.1, 3.1_

  - [x] 2.2 データベーススキーマを作成
    - BoundedContext、Term、TermHistory、TermRelationship、TermProposal、DiscussionThread、Comment、Review、UserLearning、AIAnalysisテーブルを定義
    - 適切なインデックスと制約を設定
    - マイグレーションスクリプトを作成
    - _要求: 1.1, 1.2, 3.1, 3.2, 4.1, 7.1, 10.1, 11.1, 12.1_

- [x] 3. 境界づけられたコンテキスト管理機能の実装
  - [x] 3.1 BoundedContextエンティティとリポジトリを実装
    - BoundedContextモデルクラスを作成
    - CRUD操作のためのリポジトリパターンを実装
    - _要求: 3.1_

  - [x] 3.2 ContextService を実装
    - コンテキストの作成、更新、取得機能を実装
    - コンテキストに関連する用語の取得機能を実装
    - _要求: 3.1, 3.4_

  - [x] 3.3 コンテキスト管理APIエンドポイントを作成
    - POST /api/contexts - コンテキスト作成
    - GET /api/contexts - 全コンテキスト取得
    - GET /api/contexts/:id - 特定コンテキスト取得
    - GET /api/contexts/:id/terms - コンテキストと関連用語取得
    - PUT /api/contexts/:id - コンテキスト更新
    - _要求: 3.1, 3.4_

- [ ] 4. 用語管理のコア機能を実装
  - [ ] 4.1 Termエンティティとリポジトリを実装
    - Termモデルクラスを作成
    - CRUD操作のためのリポジトリを実装
    - 一意性制約のバリデーション（コンテキスト内）
    - _要求: 1.1, 1.2_
  
  - [ ] 4.2 TermHistoryの追跡機能を実装
    - 用語更新時の履歴レコード作成
    - 変更差分の計算ロジック
    - 履歴取得機能
    - _要求: 4.1, 4.2, 4.4_
  
  - [ ] 4.3 TermServiceを実装
    - 用語の作成、更新、削除（アーカイブ）機能
    - 用語取得と履歴取得機能
    - 閲覧回数のトラッキング
    - _要求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.4, 4.1, 4.2, 4.3, 4.5_
  
  - [ ] 4.4 用語管理APIエンドポイントを作成
    - POST /api/terms - 用語作成
    - GET /api/terms/:id - 用語取得
    - PUT /api/terms/:id - 用語更新
    - DELETE /api/terms/:id - 用語削除（アーカイブ）
    - GET /api/terms/:id/history - 履歴取得
    - _要求: 1.1, 1.3, 1.4, 1.5, 4.1, 4.2, 4.3_

- [ ] 5. MeiliSearch統合と検索機能の実装
  - [ ] 5.1 MeiliSearchクライアントを設定
    - MeiliSearchへの接続を設定
    - インデックス作成と設定
    - _要求: 2.1_
  
  - [ ] 5.2 用語の検索インデックス同期を実装
    - 用語作成・更新時のインデックス更新
    - バッチインデックス更新機能
    - _要求: 2.1_
  
  - [ ] 5.3 検索機能を実装
    - 全文検索クエリの実装（2秒以内のレスポンス）
    - 検索結果のフォーマット（名前、定義プレビュー、コンテキスト）
    - 検索頻度のトラッキング
    - _要求: 2.1, 2.2, 8.3_
  
  - [ ] 5.4 検索APIエンドポイントを作成
    - GET /api/search?q=:query - 用語検索
    - _要求: 2.1, 2.2, 2.3_

- [ ] 6. 用語関連性管理機能の実装
  - [ ] 6.1 TermRelationshipエンティティとリポジトリを実装
    - TermRelationshipモデルクラスを作成
    - 関係の作成・削除機能
    - _要求: 7.1, 7.2_
  
  - [ ] 6.2 循環依存チェックロジックを実装
    - グラフトラバーサルによる循環検出
    - 集約関係での循環依存防止
    - _要求: 7.5_
  
  - [ ] 6.3 RelationshipServiceを実装
    - 関係の作成・削除機能
    - 用語の関連取得機能
    - 図生成のためのデータ準備
    - _要求: 7.1, 7.3, 7.4_
  
  - [ ] 6.4 関連性管理APIエンドポイントを作成
    - POST /api/relationships - 関係作成
    - DELETE /api/relationships/:id - 関係削除
    - GET /api/terms/:id/relationships - 関連取得
    - GET /api/contexts/:id/diagram - 図データ取得
    - _要求: 7.1, 7.3, 7.4_

- [ ] 7. 議論と承認プロセスの実装
  - [ ] 7.1 TermProposal、DiscussionThread、Commentエンティティを実装
    - 各モデルクラスとリポジトリを作成
    - _要求: 10.1_
  
  - [ ] 7.2 DiscussionServiceを実装
    - 用語候補の提案機能
    - 議論スレッドの作成とコメント追加
    - 承認・却下・保留の処理
    - 承認時の用語登録と履歴保持
    - _要求: 10.1, 10.2, 10.3, 10.4_
  
  - [ ] 7.3 議論と承認APIエンドポイントを作成
    - POST /api/proposals - 用語候補提案
    - POST /api/proposals/:id/approve - 承認
    - POST /api/proposals/:id/reject - 却下
    - POST /api/threads - スレッド作成
    - POST /api/threads/:id/comments - コメント追加
    - GET /api/threads/:id - スレッド取得
    - _要求: 10.1, 10.2, 10.3, 10.4_

- [ ] 8. 見直しサイクル管理の実装
  - [ ] 8.1 Reviewエンティティとリポジトリを実装
    - Reviewモデルクラスを作成
    - 見直し履歴の保存機能
    - _要求: 11.5_
  
  - [ ] 8.2 ReviewServiceを実装
    - 見直しスケジュール設定機能
    - 見直し期限到来の用語取得
    - 見直し実行と履歴記録
    - 通知送信機能
    - 「要議論」時の自動スレッド作成
    - _要求: 10.5, 11.1, 11.2, 11.3, 11.4, 11.5_
  
  - [ ] 8.3 見直し管理APIエンドポイントを作成
    - POST /api/terms/:id/schedule-review - 見直しスケジュール設定
    - GET /api/reviews/due - 見直し期限到来の用語取得
    - POST /api/reviews - 見直し実行
    - GET /api/terms/:id/reviews - 見直し履歴取得
    - _要求: 11.1, 11.2, 11.3, 11.5_

- [ ] 9. AI統合機能の実装
  - [ ] 9.1 AIServiceの基盤を実装
    - OpenAI APIクライアントを設定
    - 既存用語のコンテキスト構築機能
    - _要求: 12.2_
  
  - [ ] 9.2 定義の明確さ分析機能を実装
    - 定義の曖昧さ、複雑さ、欠落コンテキストの検出
    - 明確さスコアの計算
    - 改善提案の生成
    - _要求: 12.1_
  
  - [ ] 9.3 整合性チェック機能を実装
    - 既存用語との整合性評価
    - 類似用語の検出
    - 競合と推奨事項の生成
    - _要求: 12.2, 12.4_
  
  - [ ] 9.4 AI Q&A機能を実装
    - ユビキタス言語に基づく質問応答
    - コンテキスト特化の回答生成
    - _要求: 12.3_
  
  - [ ] 9.5 AIAnalysisの保存と取得機能を実装
    - 分析結果のデータベース保存
    - 分析履歴の取得
    - _要求: 12.1, 12.5_
  
  - [ ] 9.6 AI統合APIエンドポイントを作成
    - POST /api/ai/analyze-clarity - 明確さ分析
    - POST /api/ai/check-consistency - 整合性チェック
    - POST /api/ai/suggest-improvements - 改善提案
    - POST /api/ai/find-similar - 類似用語検索
    - POST /api/ai/ask - 質問応答
    - _要求: 12.1, 12.2, 12.3, 12.4, 12.5_

- [ ] 10. オンボーディング支援機能の実装
  - [ ] 10.1 UserLearningエンティティとリポジトリを実装
    - UserLearningモデルクラスを作成
    - 学習済みマーキング機能
    - _要求: 5.2_
  
  - [ ] 10.2 オンボーディング機能を実装
    - 必須用語の指定機能
    - 学習進捗の計算
    - 依存関係に基づく学習順序の生成
    - _要求: 5.1, 5.3, 5.4, 5.5_
  
  - [ ] 10.3 オンボーディングAPIエンドポイントを作成
    - GET /api/onboarding/essential-terms - 必須用語取得
    - POST /api/onboarding/mark-learned - 学習済みマーク
    - GET /api/onboarding/progress - 学習進捗取得
    - PUT /api/terms/:id/essential - 必須用語指定
    - _要求: 5.1, 5.2, 5.3, 5.4_

- [ ] 11. コード分析機能の実装
  - [ ] 11.1 CodeAnalysisエンティティとリポジトリを実装
    - CodeAnalysisモデルクラスを作成
    - 分析結果の保存機能
    - _要求: 6.1_
  
  - [ ] 11.2 コード要素抽出機能を実装
    - TypeScript/JavaScriptパーサーを使用したクラス名、メソッド名、変数名の抽出
    - _要求: 6.2_
  
  - [ ] 11.3 用語マッチング機能を実装
    - 抽出要素と登録用語の比較
    - 一致率の計算
    - リネーム提案の生成
    - _要求: 6.3, 6.4, 6.5_
  
  - [ ] 11.4 コード分析APIエンドポイントを作成
    - POST /api/code-analysis/upload - コードアップロード
    - GET /api/code-analysis/:id/report - レポート取得
    - _要求: 6.1, 6.4_

- [ ] 12. 分析とメトリクス機能の実装
  - [ ] 12.1 AnalyticsServiceを実装
    - ユーザーアクティビティのトラッキング
    - アクティブユーザー数の計算
    - カバレッジ率の計算
    - 最も閲覧・検索された用語の集計
    - _要求: 8.1, 8.2, 8.3_
  
  - [ ] 12.2 メトリクスエクスポート機能を実装
    - CSV形式でのエクスポート
    - JSON形式でのエクスポート
    - _要求: 8.5_
  
  - [ ] 12.3 分析APIエンドポイントを作成
    - GET /api/analytics/metrics - メトリクス取得
    - GET /api/analytics/export - メトリクスエクスポート
    - _要求: 8.4, 8.5_

- [ ] 13. エクスポート/インポート機能の実装
  - [ ] 13.1 ExportServiceを実装
    - JSON形式でのエクスポート（全データ）
    - Markdown形式でのエクスポート（コンテキスト別整理）
    - _要求: 13.1, 13.2_
  
  - [ ] 13.2 インポート機能を実装
    - JSONデータのバリデーション
    - データのインポート処理
    - エラーレポート生成
    - _要求: 13.4, 13.5_
  
  - [ ] 13.3 エクスポート/インポートAPIエンドポイントを作成
    - GET /api/export/json - JSONエクスポート
    - GET /api/export/markdown - Markdownエクスポート
    - POST /api/import - インポート
    - _要求: 13.1, 13.2, 13.3, 13.4, 13.5_

- [ ] 14. 認証と認可の実装
  - [ ] 14.1 JWT認証を実装
    - トークン生成と検証
    - ミドルウェアの作成
    - _要求: 全要求（セキュリティ）_
  
  - [ ] 14.2 ロールベースアクセス制御を実装
    - ユーザーロール（Admin、Editor、Reviewer、Viewer）の定義
    - 権限チェックミドルウェア
    - _要求: 全要求（セキュリティ）_
  
  - [ ] 14.3 認証APIエンドポイントを作成
    - POST /api/auth/login - ログイン
    - POST /api/auth/register - ユーザー登録
    - POST /api/auth/refresh - トークン更新
    - _要求: 全要求（セキュリティ）_

- [ ] 15. フロントエンド基盤の構築
  - [ ] 15.1 Next.jsプロジェクト構造を作成
    - ページルーティング設定
    - レイアウトコンポーネント
    - 共通UIコンポーネントライブラリの選定と設定
    - _要求: 1.1_
  
  - [ ] 15.2 APIクライアントを実装
    - バックエンドAPIとの通信レイヤー
    - エラーハンドリング
    - 認証トークン管理
    - _要求: 全要求_
  
  - [ ] 15.3 状態管理を設定
    - グローバル状態管理（Context API または Zustand）
    - キャッシング戦略
    - _要求: 全要求_

- [ ] 16. 用語管理UIの実装
  - [ ] 16.1 用語一覧ページを作成
    - コンテキスト別の用語表示
    - フィルタリングとソート機能
    - _要求: 1.1, 3.4_
  
  - [ ] 16.2 用語詳細ページを作成
    - 用語の完全な情報表示
    - 関連用語の表示
    - 履歴表示
    - 閲覧回数のトラッキング
    - _要求: 2.3, 2.4, 4.2, 4.3, 7.3_
  
  - [ ] 16.3 用語作成・編集フォームを作成
    - バリデーション付きフォーム
    - AI分析結果の表示
    - 例と使用上の注意の入力
    - _要求: 1.1, 1.3, 9.4, 12.1, 12.5_
  
  - [ ] 16.4 用語削除機能を実装
    - 削除確認ダイアログ
    - アーカイブ処理
    - _要求: 1.4, 1.5_

- [ ] 17. 検索UIの実装
  - [ ] 17.1 検索バーコンポーネントを作成
    - リアルタイム検索サジェスト
    - 検索履歴
    - _要求: 2.1_
  
  - [ ] 17.2 検索結果ページを作成
    - 検索結果の表示（名前、プレビュー、コンテキスト）
    - ページネーション
    - _要求: 2.1, 2.2_

- [ ] 18. コンテキスト管理UIの実装
  - [ ] 18.1 コンテキスト一覧ページを作成
    - 全コンテキストの表示
    - コンテキストごとの用語数表示
    - _要求: 3.4_
  
  - [ ] 18.2 コンテキスト作成・編集フォームを作成
    - 名前と説明の入力
    - バリデーション
    - _要求: 3.1_
  
  - [ ] 18.3 コンテキスト詳細ページを作成
    - コンテキスト情報と関連用語の表示
    - _要求: 3.4, 3.5_

- [ ] 19. 議論と承認UIの実装
  - [ ] 19.1 用語候補提案フォームを作成
    - 提案内容の入力
    - AI分析の自動実行と結果表示
    - _要求: 10.1, 12.1, 12.2_
  
  - [ ] 19.2 議論スレッドページを作成
    - コメントの表示と投稿
    - スレッドのステータス管理
    - _要求: 10.1, 10.2_
  
  - [ ] 19.3 承認ワークフローUIを作成
    - 承認・却下・保留ボタン
    - 却下理由の入力
    - _要求: 10.3, 10.4_

- [ ] 20. 見直しサイクルUIの実装
  - [ ] 20.1 見直し期限管理ページを作成
    - 見直し期限到来の用語一覧
    - 見直しスケジュール設定
    - _要求: 11.1, 11.2_
  
  - [ ] 20.2 見直し実行UIを作成
    - 確認済み・要更新・要議論の選択
    - 見直しノートの入力
    - _要求: 11.3, 11.4_
  
  - [ ] 20.3 見直し履歴表示を実装
    - 過去の見直し記録の表示
    - _要求: 11.5_

- [ ] 21. AI統合UIの実装
  - [ ] 21.1 AI分析結果表示コンポーネントを作成
    - 明確さスコアの視覚化
    - 問題点と提案の表示
    - 類似用語の表示
    - _要求: 12.1, 12.4, 12.5_
  
  - [ ] 21.2 AI Q&Aインターフェースを作成
    - 質問入力フォーム
    - 回答の表示
    - 会話履歴
    - _要求: 12.3_

- [ ] 22. オンボーディングUIの実装
  - [ ] 22.1 オンボーディングダッシュボードを作成
    - 必須用語リスト
    - 学習進捗の視覚化
    - 推奨学習順序の表示
    - _要求: 5.1, 5.3, 5.5_
  
  - [ ] 22.2 学習済みマーキング機能を実装
    - チェックボックスまたはボタン
    - 進捗の即時更新
    - _要求: 5.2_

- [ ] 23. 用語関連性可視化UIの実装
  - [ ] 23.1 関係作成UIを実装
    - 関係タイプの選択
    - ターゲット用語の選択
    - 説明の入力
    - _要求: 7.1, 7.2_
  
  - [ ] 23.2 用語関係図を実装
    - グラフ可視化ライブラリの統合（例: D3.js、Cytoscape.js）
    - インタラクティブな図の表示
    - _要求: 7.4_

- [ ] 24. コード分析UIの実装
  - [ ] 24.1 コードアップロードフォームを作成
    - ファイル選択とアップロード
    - 分析進捗の表示
    - _要求: 6.1_
  
  - [ ] 24.2 分析レポートページを作成
    - 一致率の表示
    - 一致・不一致要素のリスト
    - リネーム提案の表示
    - _要求: 6.3, 6.4, 6.5_

- [ ] 25. ダッシュボードとメトリクスUIの実装
  - [ ] 25.1 メインダッシュボードを作成
    - アクティブユーザー数の表示
    - カバレッジ率の表示
    - 最も閲覧された用語の表示
    - 最も検索された用語の表示
    - _要求: 2.5, 8.4_
  
  - [ ] 25.2 メトリクスエクスポート機能を実装
    - エクスポートボタン
    - フォーマット選択（CSV/JSON）
    - _要求: 8.5_

- [ ] 26. エクスポート/インポートUIの実装
  - [ ] 26.1 エクスポート機能UIを作成
    - フォーマット選択（JSON/Markdown）
    - ダウンロードボタン
    - _要求: 13.1, 13.2, 13.3_
  
  - [ ] 26.2 インポート機能UIを作成
    - ファイル選択とアップロード
    - バリデーション結果の表示
    - エラーレポートの表示
    - _要求: 13.4, 13.5_

- [ ] 27. 通知機能の実装
  - [ ] 27.1 通知サービスを実装
    - メール送信機能
    - Webhook統合
    - _要求: 10.5, 11.2_
  
  - [ ] 27.2 通知UIを実装
    - 通知一覧の表示
    - 未読管理
    - _要求: 10.5, 11.2_

- [ ] 28. システム統合とエンドツーエンドテスト
  - [ ] 28.1 主要ユーザーフローのE2Eテストを作成
    - 用語作成から承認までのフロー
    - 検索と閲覧のフロー
    - 議論と見直しのフロー
    - _要求: 全要求_
  
  - [ ] 28.2 パフォーマンステストを実施
    - 検索レスポンスタイムの検証（2秒以内）
    - エクスポート処理時間の検証（1000用語で10秒以内）
    - _要求: 2.1, 13.3_

- [ ] 29. ドキュメントとデプロイメント準備
  - [ ] 29.1 APIドキュメントを作成
    - OpenAPI/Swagger仕様
    - エンドポイントの説明と例
    - _要求: 全要求_
  
  - [ ] 29.2 ユーザーガイドを作成
    - システムの使い方
    - ベストプラクティス
    - _要求: 全要求_
  
  - [ ] 29.3 デプロイメント設定を構成
    - Docker化
    - CI/CDパイプライン設定
    - 環境変数の管理
    - _要求: 全要求_
